<html>

<head>
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="local://assets/APlayer/APlayer.min.css">
    <script src="local://assets/APlayer/color-thief.js"></script>
    <script src="local://assets/APlayer/APlayer.min.js"></script>
</head>

<body>
    <div id="aplayer"></div>
</body>

<script>
    const i = {};
    const ap = new APlayer({
        container: document.getElementById('aplayer'),
        mini: false,
        autoplay: false,
        loop: 'all',
        order: 'list',
        preload: 'auto',
        volume: 1.0,
        mutex: true,
        listFolded: false,
        listMaxHeight: 100,
        lrcType: 1,
    });
    ap.on('play', () => {
        var xmlhttp;
        if (window.XMLHttpRequest) {
            // IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp = new XMLHttpRequest();
        }
        else {
            // IE6, IE5 浏览器执行代码
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                ap.lrc.current = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET", ap.list.audios[ap.list.index]);
        xmlhttp.send();
        $notify("text", { "text": ap.list.audios[ap.list.index].lrc });
        $notify("log", { "text": `正在播放： ${ap.list.audios[ap.list.index].name}`, "count": ap.list.audios.length });
    });

    ap.on('error', () => {
        ap.list.remove(ap.list.index);
        $notify("log", { "text": "Sorry, 音频资源播放出错了..." });
    });
</script>

</html>