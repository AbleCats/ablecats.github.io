import{r as e,o as t,c as r,a as i,d as a,b as s,e as n,B as o,_ as c,f as l,i as u,t as g,n as d,g as h,h as y,j as m,k as p,s as f}from"./vendor.30866855.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const b={};b.render=function(i,a){const s=e("router-view");return t(),r(s)};const k=i({modules:{user:{namespaced:!0,actions:{addAge({commit:e,state:t},r){e("SET_USER_AGE",t.age+r)}},getters:{age:e=>e.age},mutations:{SET_USER_AGE(e,t){e.age=t}},state:{age:5}}},strict:!1});var T;const v=a({name:"Client",mounted(){T=this.$spotifyWebApi},methods:{getMe(){T.getMe().catch((async e=>{await this.refreshToken()||this.openAuthorizeURL()})).then((e=>{e.body,T.getAccessToken()}))},openAuthorizeURL(){let e=T.createAuthorizeURL(["streaming","user-read-email","user-read-private","app-remote-control","user-library-modify","playlist-modify-public","playlist-modify-private","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-recently-played","user-top-read","user-read-playback-position","ugc-image-upload"],"AbleCats");window.location.href=e},async login(e){let{body:t}=await T.authorizationCodeGrant(e);T.setAccessToken(t.access_token),T.setRefreshToken(t.refresh_token),localStorage.setItem("access_token",t.access_token),localStorage.setItem("refresh_token",t.refresh_token),this.$router.push("/")},async refreshToken(){let e=null;try{let{body:t}=await T.refreshAccessToken();T.setAccessToken(t.access_token),e=t}catch(t){this.openAuthorizeURL()}return e}}});v.render=function(e,t,r,i,a,s){return null};const P={},w={class:"actionBar"},C=[n("div",{class:"actionBarBtn"},[n("i",{class:"fa fa-chevron-circle-left","aria-hidden":"true"}),n("i",{class:"fa fa-chevron-circle-right ","aria-hidden":"true"})],-1)];P.render=function(e,r,i,a,n,o){return t(),s("div",w,C)};var I,_=null,A=null;const $=a({name:"Home",watch:{playing:{handler(e){e&&(this.getMainColor(),this.intervalPlayer())},deep:!0}},mixins:[v],methods:{toggle(){let e=this;e.curIsPlaying?e.setPause():e.setPlay()},setPlay(){let e=this;I.play().then((()=>{e.getCurPlaying(),e.intervalPlayer()}),(()=>{e.getMe()}))},setPause(){let e=this;e.playing.is_playing=!1,I.pause().then((()=>{e.getCurPlaying()}),(()=>{e.getMe()}))},getCurPlaying(){let e=this;I.getMyCurrentPlayingTrack().then((function(t){t.body&&(e.playing=t.body)}),(function(t){e.getMe()}))},getMainColor(){let e=this;(async()=>{const t=await u(this.curPlayingImg,{scale:.5,ignore:["rgb(255,255,255)","rgb(0,0,0)"]});e.themeColor=t[0].color})()},intervalPlayer(){let e=this,t=e.playing.progress_ms,r=e.playing.item.duration_ms-t;e.curTime=r,A&&clearTimeout(A),A=setTimeout((()=>{e.getCurPlaying()}),r>5e3?5e3:r),_&&clearInterval(_),e.playing.is_playing&&(_=setInterval((()=>{e.curTime=this.curTime-1e3,e.curTime<=0&&e.getCurPlaying()}),1e3))},reloadImageView(){this.screenWidth=document.body.clientWidth,this.screenHeight=document.body.clientHeight;let e=this.screenHeight>this.screenWidth;this.curWidth=e?"100%":"50%",this.curHeight=e?"50%":"100%"}},computed:{curIsPlaying(){let e=!1;try{e=this.playing.is_playing}catch(t){}return e},curPlayingImg(){let e="";try{e=this.playing.item.album.images[0].url}catch(t){}return e},curTimeFormat(){var e=new Date(1e3*Math.round(this.curTime/1e3));let t=e.getUTCMinutes(),r=e.getUTCSeconds();return`${t>10?t:`0${t}`}:${r>10?r:`0${r}`}`}},components:{Button:o,ElButton:c,ElDialog:l,ActionBar:P},data:()=>({curTime:0,playing:{},curWidth:"50%",curHeight:"100%",fontColor:"#000",themeColor:"#FFF",screenWidth:0,screenHeight:0}),mounted(){I=this.$spotifyWebApi,this.getCurPlaying(),this.reloadImageView(),window.onresize=()=>(()=>{this.reloadImageView()})()}}),M={class:"actionBar"},S={class:"time-text"};$.render=function(e,r,i,a,o,c){return t(),s("div",{class:d(["mainPlayerView"]),style:h({background:e.themeColor})},[n("div",{class:"playerImage",style:h({backgroundImage:`url(${e.curPlayingImg})`,width:e.curWidth,height:e.curHeight})},[n("div",M,[n("div",S,g(e.curTimeFormat||"00:00"),1),n("div",{class:"actionBarBtn",onClick:r[0]||(r[0]=(...t)=>e.toggle&&e.toggle(...t))},[n("i",{class:d(["fa",`fa-${e.curIsPlaying?"pause":"play"}-circle`])},null,2)])])],4)],4)};const B=a({watch:{"$route.query":{handler(e){},deep:!0}},mixins:[v],mounted(){this.$route.query&&this.$route.query.code&&this.login(this.$route.query.code)}});B.render=function(e,t,r,i,a,s){return null};const W=[{path:"/",name:"Home",component:$},{path:"/callback",name:"Callback",component:B}],E=y({history:m(),routes:W});const H=p(b),U=new f({clientId:"0468ceaf41784b0094c2a65e0f83bccf",clientSecret:"b5ec6303325a4ce8a4bb08c01090b52c",redirectUri:`${window.location.origin}/callback`}),L=localStorage.getItem("access_token"),R=localStorage.getItem("refresh_token");L&&U.setAccessToken(L),R&&U.setRefreshToken(R),H.config.globalProperties.$spotifyWebApi=U,H.use(k).use(E).mount("#app");
